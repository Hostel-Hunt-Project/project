<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Profile ‚Äì Hostel Hunt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <style>
    body { display: flex; background: #f3f4f6; min-height: 100vh; margin: 0; }
    .menu-toggle { display: none; }

    .sidebar {
      width: 250px; background: #1e3a8a; color: #fff;
      min-height: 100vh; padding: 20px; position: fixed; left: 0; top: 0;
      display: flex; flex-direction: column; gap: 20px;
    }
    .profile-photo { width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: auto; border: 3px solid #fff; }
    .profile-photo img { width: 100%; height: 100%; object-fit: cover; }
    .side-link { padding: 10px; text-align: center; border-radius: 8px; background: rgba(255,255,255,0.1); text-decoration: none; color: #fff; }
    .side-link:hover { background: rgba(255,255,255,0.2); }

    .content { margin-left: 260px; padding: 30px; width: 100%; max-width: 900px; }
    .profile-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

    .upload-box img { width: 130px; height: 130px; border-radius: 50%; object-fit: cover; border: 3px solid #ddd; }
    .upload-btn { background: #2563eb; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; }

    .form-group { margin-bottom: 15px; }
    .form-group input, .form-group select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #d1d5db; }

    .btn-save { background: #2563eb; color: white; padding: 10px 16px; border-radius: 8px; cursor: pointer; }
  </style>
</head>

<body>

<div class="menu-toggle" id="menuToggle">‚ò∞</div>

<aside class="sidebar" id="sidebar">
  <div class="profile-photo">
    <img id="sidebarPhoto" src="https://via.placeholder.com/120" />
  </div>
  <h3 id="sidebarName">User</h3>

  <a class="side-link" href="index.html">üè† Home</a>
  <a class="side-link" href="profile.html">üë§ View Profile</a>
  <a class="side-link" href="profile.html">‚úèÔ∏è Edit Profile</a>
  <a class="side-link" href="#" id="logoutBtn">üö™ Logout</a>
</aside>

<main class="content">
  <div class="profile-card">
    <h2>Edit Your Profile</h2>

    <div class="upload-box">
      <img id="previewPhoto" src="https://via.placeholder.com/130" />
      <br />
      <label class="upload-btn">
        Upload Photo
        <input type="file" id="photoInput" accept="image/*" hidden />
      </label>
    </div>

    <form id="profileForm">
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="name" required />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" id="email" disabled />
      </div>

      <div class="form-group">
        <label>Phone</label>
        <input type="text" id="phone" />
      </div>

      <div class="form-group">
        <label>College</label>
        <input type="text" id="college" />
      </div>

      <div class="form-group">
        <label>Gender</label>
        <select id="gender">
          <option value="">Select</option>
          <option>male</option>
          <option>female</option>
          <option>other</option>
        </select>
      </div>

      <button class="btn-save">Save Profile</button>
      <p id="profileMessage" style="margin-top:10px;"></p>
    </form>
  </div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const app = initializeApp({
    apiKey: "AIzaSyAOKTqpJmN-43fDQrZVmfGCVlK_8JBTrvY",
    authDomain: "hostelhunt-1df83.firebaseapp.com",
    projectId: "hostelhunt-1df83",
    storageBucket: "hostelhunt-1df83.firebasestorage.app",
    messagingSenderId: "272376261500",
    appId: "1:272376261500:web:719ada3e6b22090c5b12f9"
  });

  const auth = getAuth();
  const db = getFirestore();

  const previewPhoto = document.getElementById("previewPhoto");
  const sidebarPhoto = document.getElementById("sidebarPhoto");
  const sidebarName = document.getElementById("sidebarName");

  onAuthStateChanged(auth, async (user) => {
    if (!user) return (location.href = "login.html");

    const snap = await getDoc(doc(db, "users", user.uid));
    const data = snap.data() || {};

    document.getElementById("name").value = data.name || "";
    document.getElementById("email").value = user.email;
    document.getElementById("phone").value = data.phone || "";
    document.getElementById("college").value = data.collegeName || "";
    document.getElementById("gender").value = data.gender || "";

    if (data.photoURL) {
      previewPhoto.src = data.photoURL;
      sidebarPhoto.src = data.photoURL;
    }

    sidebarName.textContent = data.name || "User";
  });

  document.getElementById("profileForm").onsubmit = async (e) => {
    e.preventDefault();

    const user = auth.currentUser;
    if (!user) return;

    const updateData = {
      name: document.getElementById("name").value,
      phone: document.getElementById("phone").value,
      collegeName: document.getElementById("college").value,
      gender: document.getElementById("gender").value
    };

    await setDoc(doc(db, "users", user.uid), updateData, { merge: true });

    document.getElementById("profileMessage").style.color = "green";
    document.getElementById("profileMessage").textContent = "Profile updated!";
  };

  document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    location.href = "login.html";
  };
</script>
<script type="module" src="firebase.js"></script>

</body>
</html>

